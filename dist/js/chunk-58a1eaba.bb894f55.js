(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-58a1eaba"],{"0d83":function(e,t,a){},a156:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ckeditor",e._b({attrs:{editor:e.editor,config:e.editorConfig},model:{value:e.editorData,callback:function(t){e.editorData=t},expression:"editorData"}},"ckeditor",e.$attrs,!1))},n=[],r={name:"OmspEditor",components:{},props:{value:{type:String,default:""}},data:function(){return{editor:this.$OmspClassicEditor,editorData:"",editorConfig:{placeholder:"请输入······",toolbar:[]}}},watch:{value:function(e){this.editorData=e},editorData:function(e){this.$emit("input",e)}},mounted:function(){this.editorData=this.value}},c=r,o=a("2877"),s=Object(o["a"])(c,i,n,!1,null,"83061b96",null);t["a"]=s.exports},da93:function(e,t,a){"use strict";a.r(t);var i,n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"omsp-eventregist",attrs:{id:"omspeventregist"}},[a("van-nav-bar",{staticClass:"omsp-nav-bar",attrs:{title:"事件登记","left-text":"返回","left-arrow":"",fixed:""},on:{"click-left":e.backToIndex}}),a("div",{staticClass:"omsp-eventregist-body"},[a("van-tabs",{attrs:{"lazy-render":!1},model:{value:e.tabNum,callback:function(t){e.tabNum=t},expression:"tabNum"}},[a("van-tab",{attrs:{title:"基本信息"}},[a("van-cell-group",[a("van-field",{attrs:{"input-align":"right",clearable:"",label:"事件标题",placeholder:"请输入",clickable:"",required:""},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),a("van-field",{attrs:{"input-align":"right",clearable:"",label:"发生时间",placeholder:"点击选择时间",clickable:"",readonly:"",required:""},on:{click:function(t){e.showOccurDatePickerFlag=!0}},model:{value:e.occurDate,callback:function(t){e.occurDate=t},expression:"occurDate"}}),a("van-field",{attrs:{"input-align":"right",clearable:"",label:"申请人",placeholder:"请输入",clickable:"",readonly:"",required:""},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),a("van-field",{attrs:{"input-align":"right",clearable:"",label:"申请人电话",placeholder:"请输入",clickable:"",readonly:"",required:""},on:{click:function(t){e.showCreatUserTelKeyboard=!0}},model:{value:e.creatUserTel,callback:function(t){e.creatUserTel=t},expression:"creatUserTel"}}),a("van-field",{attrs:{"input-align":"right",clearable:"",label:"所属部门",placeholder:"点击选择所属部门","default-index":"0",clickable:"","right-icon":"arrow",readonly:"",required:""},on:{click:function(t){e.showOriginSelectorFlag=!0}},model:{value:e.origin.name,callback:function(t){e.$set(e.origin,"name",t)},expression:"origin.name"}}),a("van-field",{attrs:{"input-align":"right",clearable:"",label:"紧急度",placeholder:"点击选择紧急度",clickable:"","right-icon":"arrow",readonly:"",required:""},on:{click:function(t){e.showUrgencySelectorFlag=!0}},model:{value:e.urgency.name,callback:function(t){e.$set(e.urgency,"name",t)},expression:"urgency.name"}}),a("van-field",{attrs:{"input-align":"right",clearable:"",label:"事件分类",placeholder:"点击选择事件类型",clickable:"","right-icon":"arrow",readonly:"",required:""},on:{click:function(t){e.showCategorySelectorFlag=!0}},model:{value:e.category.name,callback:function(t){e.$set(e.category,"name",t)},expression:"category.name"}}),a("van-field",{attrs:{"input-align":"right",clearable:"",label:"事件级别",placeholder:"点击选择事件级别",clickable:"","right-icon":"arrow",readonly:"",required:""},on:{click:function(t){e.showIncidentLevelSelectorFlag=!0}},model:{value:e.incidentLevel.name,callback:function(t){e.$set(e.incidentLevel,"name",t)},expression:"incidentLevel.name"}}),a("van-field",{attrs:{"input-align":"right",clearable:"",label:"所属团队",placeholder:"点击选择所属团队",clickable:"","right-icon":"arrow",readonly:"",required:""},on:{click:function(t){e.showTeamSelectorFlag=!0}},model:{value:e.team.name,callback:function(t){e.$set(e.team,"name",t)},expression:"team.name"}}),a("van-field",{attrs:{"input-align":"right",clearable:"",label:"所属系统",placeholder:"点击选择所属系统",clickable:"","right-icon":"arrow",readonly:"",required:""},on:{click:function(t){e.showTargetSysSelectorFlag=!0}},model:{value:e.targetSys.name,callback:function(t){e.$set(e.targetSys,"name",t)},expression:"targetSys.name"}})],1),a("van-cell-group",[a("van-panel",{attrs:{title:"事件描述",icon:"comment"}},[a("omsp-editor",{model:{value:e.editorData,callback:function(t){e.editorData=t},expression:"editorData"}})],1)],1)],1),a("van-tab",{attrs:{title:"附件管理"}},[a("task-file",{ref:"omspFile",attrs:{bsid:e.bsid||e.$route.params.bsid,biz_code:e.biz_code}})],1)],1)],1),a("div",{staticClass:"omsp-eventregist-foot"},[a("div",{staticClass:"omsp-eventregist-foot-grid"},[a("div",{staticClass:"omsp-eventregist-foot-grid-item",staticStyle:{"background-color":"#1A88E9"}},[a("div",{staticClass:"omsp-eventregist-foot-grid-item-center",on:{click:function(t){return e.save("commit")}}},[a("span",{staticClass:"omsp-eventregist-foot-grid-item-center-text"},[e._v("提交")])])]),a("div",{staticClass:"omsp-eventregist-foot-grid-item",staticStyle:{"background-color":"#BBBCC2"}},[a("div",{staticClass:"omsp-eventregist-foot-grid-item-center",on:{click:function(t){return e.save("draft")}}},[a("span",{staticClass:"omsp-eventregist-foot-grid-item-center-text"},[e._v("存为草稿")])])])])]),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showOccurDatePickerFlag,callback:function(t){e.showOccurDatePickerFlag=t},expression:"showOccurDatePickerFlag"}},[a("van-datetime-picker",{attrs:{type:"datetime","min-date":e.minOccurDate,"max-date":e.maxOccurDate},on:{confirm:e.confirmOccurDate,cancel:function(t){e.showOccurDatePickerFlag=!1}},model:{value:e.pickingOccurDate,callback:function(t){e.pickingOccurDate=t},expression:"pickingOccurDate"}})],1),a("van-number-keyboard",{attrs:{show:e.showCreatUserTelKeyboard,theme:"custom","extra-key":".","close-button-text":"完成"},on:{blur:function(t){e.showCreatUserTelKeyboard=!1}},model:{value:e.creatUserTel,callback:function(t){e.creatUserTel=t},expression:"creatUserTel"}}),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showOriginSelectorFlag,callback:function(t){e.showOriginSelectorFlag=t},expression:"showOriginSelectorFlag"}},[a("van-picker",{attrs:{loading:e.originLoading,columns:e.originSelector,"show-toolbar":"",title:"所属部门"},on:{cancel:function(t){e.showOriginSelectorFlag=!1},confirm:e.confirmOrigin,change:e.changeOrigin}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showUrgencySelectorFlag,callback:function(t){e.showUrgencySelectorFlag=t},expression:"showUrgencySelectorFlag"}},[a("van-picker",{attrs:{loading:e.urgencyLoading,columns:e.urgencySelector,"show-toolbar":"",title:"紧急度"},on:{cancel:function(t){e.showUrgencySelectorFlag=!1},confirm:e.confirmUrgency}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showCategorySelectorFlag,callback:function(t){e.showCategorySelectorFlag=t},expression:"showCategorySelectorFlag"}},[a("van-picker",{attrs:{loading:e.categoryLoading,columns:e.categorySelector,"show-toolbar":"",title:"事件分类"},on:{cancel:function(t){e.showCategorySelectorFlag=!1},confirm:e.confirmCategory}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showIncidentLevelSelectorFlag,callback:function(t){e.showIncidentLevelSelectorFlag=t},expression:"showIncidentLevelSelectorFlag"}},[a("van-picker",{attrs:{loading:e.incidentLevelLoading,columns:e.incidentLevelSelector,"show-toolbar":"",title:"事件级别"},on:{cancel:function(t){e.showIncidentLevelSelectorFlag=!1},confirm:e.confirmIncidentLevel}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showTeamSelectorFlag,callback:function(t){e.showTeamSelectorFlag=t},expression:"showTeamSelectorFlag"}},[a("van-picker",{attrs:{loading:e.teamLoading,columns:e.teamSelector,"show-toolbar":"",title:"所属团队"},on:{cancel:function(t){e.showTeamSelectorFlag=!1},confirm:e.confirmTeam}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showTargetSysSelectorFlag,callback:function(t){e.showTargetSysSelectorFlag=t},expression:"showTargetSysSelectorFlag"}},[a("van-picker",{attrs:{loading:e.targetSysLoading,columns:e.targetSysSelector,"show-toolbar":"",title:"所属系统"},on:{cancel:function(t){e.showTargetSysSelectorFlag=!1},confirm:e.confirmTargetSys}})],1)],1)])},r=[],c=(a("7514"),a("47e2"),a("2241")),o=(a("6762"),a("bd86")),s=(a("558f"),a("0b33")),l=(a("8990"),a("5e46")),g=(a("d707"),a("8f80")),d=(a("a035"),a("21ab")),u=(a("4072"),a("2830")),m=(a("2a53"),a("34e9")),h=(a("3ec1"),a("7744")),f=(a("8e11"),a("f253")),p=(a("81a6"),a("7bd9")),y=(a("c625"),a("b650")),b=(a("87d0"),a("e41f")),v=(a("578d"),a("ee83")),S=(a("aa1f"),a("ea47")),L=(a("9eda"),a("565f")),w=(a("433b"),a("d399")),_=(a("da02"),a("6b41")),k=a("0ed4"),O=a("a156"),D={name:"AddIncident",components:(i={OmspEditor:O["a"]},Object(o["a"])(i,_["a"].name,_["a"]),Object(o["a"])(i,w["a"].name,w["a"]),Object(o["a"])(i,L["a"].name,L["a"]),Object(o["a"])(i,S["a"].name,S["a"]),Object(o["a"])(i,v["a"].name,v["a"]),Object(o["a"])(i,b["a"].name,b["a"]),Object(o["a"])(i,y["a"].name,y["a"]),Object(o["a"])(i,p["a"].name,p["a"]),Object(o["a"])(i,f["a"].name,f["a"]),Object(o["a"])(i,h["a"].name,h["a"]),Object(o["a"])(i,m["a"].name,m["a"]),Object(o["a"])(i,u["a"].name,u["a"]),Object(o["a"])(i,d["a"].name,d["a"]),Object(o["a"])(i,g["a"].name,g["a"]),Object(o["a"])(i,l["a"].name,l["a"]),Object(o["a"])(i,s["a"].name,s["a"]),Object(o["a"])(i,"TaskFile",k["a"]),i),data:function(){return{incidentData:{},biz_code:"SJ",tabNum:0,bsid:"",title:"",userid:"",username:"",showOccurDatePickerFlag:!1,minOccurDate:new Date(2e3,0,1),maxOccurDate:new Date,pickingOccurDate:new Date,occurDate:"",showCreatUserTelKeyboard:!1,creatUserTel:"",origin:"",showOriginSelectorFlag:!1,originLoading:!0,originSelector:[],originList:[],urgency:"",showUrgencySelectorFlag:!1,urgencyLoading:!0,urgencySelector:[],urgencyList:[],category:"",showCategorySelectorFlag:!1,categoryLoading:!0,categorySelector:[],categoryList:[],incidentLevel:"",showIncidentLevelSelectorFlag:!1,incidentLevelLoading:!0,incidentLevelSelector:[],incidentLevelList:[],team:"",showTeamSelectorFlag:!1,teamLoading:!0,teamSelector:[],teamList:[],showTargetSysSelectorFlag:!1,targetSysSelector:[],targetSys:"",targetSysLoading:!0,targetSysList:[],editorData:"",source:{},sourceList:[],wtSource:{},wtSourceList:[],imgPreviewList:[],imgFileList:[]}},computed:{},mounted:function(){this.confirmOccurDate(new Date),this.getBasicInfo()},methods:{backToIndex:function(){this.$router.slid="right",this.$router.back()},confirmOccurDate:function(e){var t=e.getMonth()+1;this.occurDate=e.getFullYear()+"-"+(t>9?t:"0"+t)+"-"+(e.getDate()>9?e.getDate():"0"+e.getDate())+" "+(e.getHours()>9?e.getHours():"0"+e.getHours())+":"+(e.getMinutes()>9?e.getMinutes():"0"+e.getMinutes())+":00",this.showOccurDatePickerFlag=!1},changeOrigin:function(e,t,a){},confirmOrigin:function(e,t){this.origin=this.originList[t],this.showOriginSelectorFlag=!1},confirmUrgency:function(e,t){this.urgency=this.urgencyList[t],this.showUrgencySelectorFlag=!1},confirmCategory:function(e,t){this.category=this.categoryList[t],this.showCategorySelectorFlag=!1},confirmIncidentLevel:function(e,t){this.incidentLevel=this.incidentLevelList[t],this.showIncidentLevelSelectorFlag=!1},confirmTeam:function(e,t){var a=this;this.team=this.teamList[t],this.showTeamSelectorFlag=!1,setTimeout((function(){a.$OmspRequest.sendRequest({url:"/appTaskRestService/getTargetSys",data:{team_id:a.team.id}}).then((function(e){a.targetSys=[],a.targetSysList=e.data.targetSysList,a.targetSysSelector=[];for(var t=0;t<a.targetSysList.length;t++)a.targetSysSelector.push(a.targetSysList[t].name);1===a.targetSysList.length&&(a.targetSys=a.targetSysList[0]),a.targetSysLoading=!1,setTimeout((function(){for(var e=0;e<a.targetSysList.length;e++)a.incidentData.target_sys===a.targetSysList[e].id&&(a.targetSys=a.targetSysList[e])}),0)})).catch((function(e){JSON.stringify(e),Object(w["a"])("获取所属系统失败")})).finally((function(){}))}),0)},confirmTargetSys:function(e,t){"number"===typeof t&&(this.targetSys=this.targetSysList[t]),this.showTargetSysSelectorFlag=!1},beforeReadImg:function(e){var t=e.type,a=["image/png","image/jpeg"];return!!a.includes(t)||(w["a"].fail("请上传:png、jpeg的图片格式"),!1)},afterReadImg:function(e){return e},save:function(e){var t=this,a=this.checkForm();a.flag?c["a"].confirm({title:"通知",message:"确定这项操作吗?"}).then((function(){w["a"].loading({mask:!0,forbidClick:!0,duration:0,message:"请稍后..."});var a=t.getFormData();setTimeout((function(){t.$OmspRequest.sendRequest({url:"/appTaskRestService/saveIncident",data:a}).then((function(a){w["a"].clear(),t.bsid=a.data.id,t.$nextTick((function(){t.$store.commit("page/removeCachePageName","OmspIndex"),"draft"===e?t.keepEdit():"commit"===e&&t.submit()}))})).catch((function(e){JSON.stringify(e),w["a"].fail("暂存失败")})).finally((function(){}))}),0)})).catch((function(){})):w["a"].fail(a.msg)},keepEdit:function(){var e=this;c["a"].confirm({title:"暂存成功",message:"是否继续修改？"}).then((function(){})).catch((function(){setTimeout((function(){e.$router.push({path:"index"})}))}))},submit:function(){var e=this;w["a"].loading({mask:!0,forbidClick:!0,duration:0,message:"提交中，请稍后..."});var t=this.getFormData();setTimeout((function(){e.$OmspRequest.sendRequest({url:"/appTaskRestService/submitIncident",data:{id:t.id}}).then((function(t){w["a"].clear(),c["a"].alert({message:"提交成功，即将返回主页"}).then((function(){e.$store.commit("page/removeCachePageName","OmspIndex"),setTimeout((function(){e.$router.push({path:"index"})}))}))})).catch((function(e){JSON.stringify(e),w["a"].fail("提交失败")})).finally((function(){}))}),0)},getFormData:function(){var e={bg_change_type:"",wt_source_desc:this.wtSource.name,urgency_desc:this.urgency.name,bg_orgname:"",is_view:"",bg_applicant_phone:"",wt_target_sys:"",source:"01",team_id:this.team.id,wt_occur_frequency_desc:"",incident_level:this.incidentLevel.id,wt_register:"",bg_target_sys_desc:"",category_desc:this.category.name,target_sys:this.targetSys.id,bg_team_id_desc:"",id:this.bsid,bg_urgency:"",bg_urgency_desc:"",bg_team_id:"",orgid:this.origin.id,wt_registe_date:"",occur_date:this.occurDate,wt_team_id_desc:"",bg_category_desc:"",plan_finish_date:"",wt_team_id:"",bg_change_plan:"",wt_urgency:"",org_id:this.origin.id,wt_urgency_desc:"",bg_category:"",bg_effect_scope:"",bg_applicant:"",incident_level_desc:this.incidentLevel.name,bg_id:"",description:this.editorData,title:this.title,wt_again_occur_risk:"",wt_registe_phone:"",is_base:"1",orgname:"",urgency:this.urgency.id,is_draft:"1",source_desc:this.source.name,bg_change_type_desc:"",wt_title:"",bg_title:"",wt_category:"",bg_target_sys:"",wt_category_desc:"",wt_source:this.wtSource.id,pos_orgname:this.origin.orgname,applicant_phone:this.creatUserTel,team_id_desc:this.team.name,applicant:this.username,wt_target_sys_desc:"",menuid:"",category:this.category.id,wt_occur_frequency:"",wt_orgname:"",target_sys_desc:this.targetSys.name,wt_id:""};return e},getBasicInfo:function(){var e=this;Object(w["a"])({type:"loading",overlay:!0,message:"加载中...",duration:0,forbidClick:!0}),setTimeout((function(){e.$OmspRequest.sendRequest({url:"/appTaskRestService/getTaskBasicInfo",data:{}}).then((function(t){w["a"].clear(),e.username=t.data.username,e.userid=t.data.userid,e.originList=t.data.originList,e.originSelector=[];for(var a=0;a<e.originList.length;a++)e.originSelector.push(e.originList[a].name);e.originLoading=!1,1===e.originList.length&&(e.origin=e.originList[0]),e.urgencySelector=[],e.urgencyList=t.data.urgencyList;for(var i=0;i<e.urgencyList.length;i++)e.urgencySelector.push(e.urgencyList[i].name);e.urgencyLoading=!1,e.categorySelector=[],e.categoryList=t.data.categoryList;for(var n=0;n<e.categoryList.length;n++)e.categorySelector.push(e.categoryList[n].name);e.categoryLoading=!1,e.incidentLevelSelector=[],e.incidentLevelList=t.data.incidentLevelList;for(var r=0;r<e.incidentLevelList.length;r++)e.incidentLevelSelector.push(e.incidentLevelList[r].name);e.incidentLevelLoading=!1,e.teamList=t.data.teamList,e.teamSelector=[];for(var c=0;c<e.teamList.length;c++)e.teamSelector.push(e.teamList[c].name);e.teamLoading=!1,1===e.teamList.length&&(e.team=e.teamList[0],e.confirmTeam("",0)),e.sourceList=t.data.incidentSource,e.source=e.sourceList.find((function(e){return"02"===e.id})),e.wtSourceList=t.data.problemSource,e.wtSource=e.wtSourceList.find((function(e){return"02"===e.id})),e.$route.query.bsid&&(e.bsid=e.$route.query.bsid,e.getInfoData(e.bsid))})).catch((function(e){JSON.stringify(e),Object(w["a"])("加载基础数据失败")})).finally((function(){}))}),0)},checkForm:function(){var e={flag:!1,msg:""};return""===this.title?e.msg="请输入标题":""===this.occurDate?e.msg="请输入发生时间":""===this.username?e.msg="没有申请人":""===this.creatUserTel?e.msg="请输入申请人电话":""===this.origin?e.msg="所属部门为空":""===this.urgency?e.msg="请选择紧急度":""===this.category?e.msg="请选择事件分类":""===this.incidentLevel?e.msg="请选择事件级别":""===this.team?e.msg="请选择所属团队":""===this.targetSys?e.msg="请选择所属系统":""===this.editorData?e.msg="请输入事件描述":e.flag=!0,e},getInfoData:function(e){var t=this;setTimeout((function(){t.$OmspRequest.sendRequest({url:"/appTaskRestService/getIncident",data:{id:e}}).then((function(e){t.incidentData=JSON.parse(e.data.incidentData),t.bsid=t.incidentData.id,t.title=t.incidentData.title,t.pickingOccurDate=t.incidentData.occur_date,t.occurDate=t.incidentData.occur_date,t.creatUserTel=t.incidentData.applicant_phone;for(var a=0;a<t.originList.length;a++)t.incidentData.orgid===t.originList[a].id&&(t.origin=t.originList[a]);for(var i=0;i<t.categoryList.length;i++)t.incidentData.category===t.categoryList[i].id&&(t.category=t.categoryList[i]);for(var n=0;n<t.urgencyList.length;n++)t.incidentData.urgency===t.urgencyList[n].id&&(t.urgency=t.urgencyList[n]);for(var r=0;r<t.incidentLevelList.length;r++)t.incidentData.incident_level===t.incidentLevelList[r].id&&(t.incidentLevel=t.incidentLevelList[r]);for(var c=0;c<t.teamList.length;c++)t.incidentData.team_id===t.teamList[c].id&&t.confirmTeam("",c);t.editorData=t.incidentData.description})).catch((function(e){console.log(e),JSON.stringify(e),Object(w["a"])("加载失败，请重新登录")})).finally((function(){}))}),0)}}},F=D,T=(a("de15"),a("2877")),x=Object(T["a"])(F,n,r,!1,null,"21926696",null);t["default"]=x.exports},de15:function(e,t,a){"use strict";var i=a("0d83"),n=a.n(i);n.a}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-02763016"],{"4c4b":function(e,t,a){"use strict";var i=a("8468"),r=a.n(i);r.a},"4cbe":function(e,t,a){"use strict";a.r(t);var i,r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"omsp-eventregist",attrs:{id:"omspeventregist"}},[a("van-nav-bar",{staticClass:"omsp-nav-bar",attrs:{title:"问题登记","left-text":"返回","left-arrow":"",fixed:""},on:{"click-left":e.backToIndex}}),a("div",{staticClass:"omsp-eventregist-body"},[a("van-tabs",{attrs:{"lazy-render":!1},model:{value:e.tabNum,callback:function(t){e.tabNum=t},expression:"tabNum"}},[a("van-tab",{attrs:{title:"基本信息"}},[a("van-cell-group",[a("van-field",{attrs:{"input-align":"right",required:"",clearable:"",label:"问题标题",placeholder:"请输入",clickable:""},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),a("van-field",{attrs:{"input-align":"right",required:"",clearable:"",label:"提出时间",placeholder:"点击选择时间",clickable:"",readonly:""},on:{click:function(t){e.showOccurDatePickerFlag=!0}},model:{value:e.registeDate,callback:function(t){e.registeDate=t},expression:"registeDate"}}),a("van-field",{attrs:{"input-align":"right",required:"",clearable:"",label:"提出人",placeholder:"请输入",clickable:"",readonly:""},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),a("van-field",{attrs:{"input-align":"right",required:"",clearable:"",label:"提出人电话",placeholder:"请输入",clickable:"",readonly:""},on:{click:function(t){e.showCreatUserTelKeyboard=!0}},model:{value:e.creatUserTel,callback:function(t){e.creatUserTel=t},expression:"creatUserTel"}}),a("van-field",{attrs:{"input-align":"right",required:"",clearable:"",label:"问题分类",placeholder:"点击选择问题类型",clickable:"","right-icon":"arrow",readonly:""},on:{click:function(t){e.showCategorySelectorFlag=!0}},model:{value:e.category.name,callback:function(t){e.$set(e.category,"name",t)},expression:"category.name"}}),a("van-field",{attrs:{"input-align":"right",required:"",clearable:"",label:"紧急度",placeholder:"点击选择紧急度",clickable:"","right-icon":"arrow",readonly:""},on:{click:function(t){e.showUrgencySelectorFlag=!0}},model:{value:e.urgency.name,callback:function(t){e.$set(e.urgency,"name",t)},expression:"urgency.name"}}),a("van-field",{attrs:{"input-align":"right",required:"",clearable:"",label:"所属部门",placeholder:"点击选择所属部门","default-index":"0",clickable:"","right-icon":"arrow",readonly:""},on:{click:function(t){e.showOriginSelectorFlag=!0}},model:{value:e.origin.name,callback:function(t){e.$set(e.origin,"name",t)},expression:"origin.name"}}),a("van-field",{attrs:{"input-align":"right",required:"",clearable:"",label:"所属团队",placeholder:"点击选择所属团队",clickable:"","right-icon":"arrow",readonly:""},on:{click:function(t){e.showTeamSelectorFlag=!0}},model:{value:e.team.name,callback:function(t){e.$set(e.team,"name",t)},expression:"team.name"}}),a("van-field",{attrs:{"input-align":"right",required:"",clearable:"",label:"所属系统",placeholder:"点击选择所属系统",clickable:"","right-icon":"arrow",readonly:""},on:{click:function(t){e.showTargetSysSelectorFlag=!0}},model:{value:e.targetSys.name,callback:function(t){e.$set(e.targetSys,"name",t)},expression:"targetSys.name"}}),a("van-field",{attrs:{"input-align":"right",clearable:"",label:"发生频率",placeholder:"请输入发生频率",clickable:"","right-icon":"arrow",readonly:""},on:{click:function(t){e.showOccurFrequencySelectorFlag=!0}},model:{value:e.occurFrequency.name,callback:function(t){e.$set(e.occurFrequency,"name",t)},expression:"occurFrequency.name"}}),a("van-field",{attrs:{"input-align":"right",clearable:"",label:"再次发生风险",placeholder:"请输入",clickable:""},model:{value:e.againOccurRisk,callback:function(t){e.againOccurRisk=t},expression:"againOccurRisk"}})],1),a("van-cell-group",[a("van-panel",{attrs:{title:"问题描述",icon:"comment"}},[a("omsp-editor",{model:{value:e.editorData,callback:function(t){e.editorData=t},expression:"editorData"}})],1)],1)],1),a("van-tab",{attrs:{title:"附件管理"}},[a("task-file",{attrs:{bsid:e.bsid||e.$route.params.bsid,biz_code:e.biz_code}})],1)],1)],1),a("div",{staticClass:"omsp-eventregist-foot"},[a("div",{staticClass:"omsp-eventregist-foot-grid"},[a("div",{staticClass:"omsp-eventregist-foot-grid-item",staticStyle:{"background-color":"#1A88E9"}},[a("div",{staticClass:"omsp-eventregist-foot-grid-item-center",on:{click:function(t){return e.save("commit")}}},[a("span",{staticClass:"omsp-eventregist-foot-grid-item-center-text"},[e._v("提交")])])]),a("div",{staticClass:"omsp-eventregist-foot-grid-item",staticStyle:{"background-color":"#BBBCC2"}},[a("div",{staticClass:"omsp-eventregist-foot-grid-item-center",on:{click:function(t){return e.save("draft")}}},[a("span",{staticClass:"omsp-eventregist-foot-grid-item-center-text"},[e._v("存为草稿")])])])])]),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showOccurDatePickerFlag,callback:function(t){e.showOccurDatePickerFlag=t},expression:"showOccurDatePickerFlag"}},[a("van-datetime-picker",{attrs:{type:"datetime",title:"提出时间","min-date":e.minOccurDate,"max-date":e.maxOccurDate},on:{confirm:e.confirmOccurDate,cancel:function(t){e.showOccurDatePickerFlag=!1}},model:{value:e.pickingOccurDate,callback:function(t){e.pickingOccurDate=t},expression:"pickingOccurDate"}})],1),a("van-number-keyboard",{attrs:{show:e.showCreatUserTelKeyboard,theme:"custom","extra-key":".","close-button-text":"完成"},on:{blur:function(t){e.showCreatUserTelKeyboard=!1}},model:{value:e.creatUserTel,callback:function(t){e.creatUserTel=t},expression:"creatUserTel"}}),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showUrgencySelectorFlag,callback:function(t){e.showUrgencySelectorFlag=t},expression:"showUrgencySelectorFlag"}},[a("van-picker",{attrs:{loading:e.urgencyLoading,columns:e.urgencySelector,"show-toolbar":"",title:"紧急度"},on:{cancel:function(t){e.showUrgencySelectorFlag=!1},confirm:e.confirmUrgency}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showCategorySelectorFlag,callback:function(t){e.showCategorySelectorFlag=t},expression:"showCategorySelectorFlag"}},[a("van-picker",{attrs:{loading:e.categoryLoading,columns:e.categorySelector,"show-toolbar":"",title:"问题分类"},on:{cancel:function(t){e.showCategorySelectorFlag=!1},confirm:e.confirmCategory}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showOccurFrequencySelectorFlag,callback:function(t){e.showOccurFrequencySelectorFlag=t},expression:"showOccurFrequencySelectorFlag"}},[a("van-picker",{attrs:{loading:e.occurFrequencyLoading,columns:e.occurFrequencySelector,"show-toolbar":"",title:"发生频率"},on:{cancel:function(t){e.showOccurFrequencySelectorFlag=!1},confirm:e.confirmOccurFrequency}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showOriginSelectorFlag,callback:function(t){e.showOriginSelectorFlag=t},expression:"showOriginSelectorFlag"}},[a("van-picker",{attrs:{loading:e.originLoading,columns:e.originSelector,"show-toolbar":"",title:"所属部门"},on:{cancel:function(t){e.showOriginSelectorFlag=!1},confirm:e.confirmOrigin}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showTeamSelectorFlag,callback:function(t){e.showTeamSelectorFlag=t},expression:"showTeamSelectorFlag"}},[a("van-picker",{attrs:{loading:e.teamLoading,columns:e.teamSelector,"show-toolbar":"",title:"所属团队"},on:{cancel:function(t){e.showTeamSelectorFlag=!1},confirm:e.confirmTeam}})],1),a("van-popup",{attrs:{position:"bottom"},model:{value:e.showTargetSysSelectorFlag,callback:function(t){e.showTargetSysSelectorFlag=t},expression:"showTargetSysSelectorFlag"}},[a("van-picker",{attrs:{loading:e.targetSysLoading,columns:e.targetSysSelector,"show-toolbar":"",title:"所属系统"},on:{cancel:function(t){e.showTargetSysSelectorFlag=!1},confirm:e.confirmTargetSys}})],1)],1)])},c=[],n=(a("7514"),a("47e2"),a("2241")),o=(a("6762"),a("bd86")),s=(a("8990"),a("5e46")),l=(a("558f"),a("0b33")),u=(a("d707"),a("8f80")),g=(a("a035"),a("21ab")),d=(a("4072"),a("2830")),m=(a("2a53"),a("34e9")),h=(a("3ec1"),a("7744")),f=(a("8e11"),a("f253")),y=(a("81a6"),a("7bd9")),p=(a("c625"),a("b650")),b=(a("87d0"),a("e41f")),v=(a("578d"),a("ee83")),S=(a("aa1f"),a("ea47")),_=(a("9eda"),a("565f")),k=(a("433b"),a("d399")),L=(a("da02"),a("6b41")),F=a("0ed4"),O=a("a156"),w={name:"OmspAddProblem",components:(i={},Object(o["a"])(i,L["a"].name,L["a"]),Object(o["a"])(i,k["a"].name,k["a"]),Object(o["a"])(i,_["a"].name,_["a"]),Object(o["a"])(i,S["a"].name,S["a"]),Object(o["a"])(i,v["a"].name,v["a"]),Object(o["a"])(i,b["a"].name,b["a"]),Object(o["a"])(i,p["a"].name,p["a"]),Object(o["a"])(i,y["a"].name,y["a"]),Object(o["a"])(i,f["a"].name,f["a"]),Object(o["a"])(i,h["a"].name,h["a"]),Object(o["a"])(i,m["a"].name,m["a"]),Object(o["a"])(i,d["a"].name,d["a"]),Object(o["a"])(i,g["a"].name,g["a"]),Object(o["a"])(i,u["a"].name,u["a"]),Object(o["a"])(i,l["a"].name,l["a"]),Object(o["a"])(i,s["a"].name,s["a"]),Object(o["a"])(i,"TaskFile",F["a"]),Object(o["a"])(i,"OmspEditor",O["a"]),i),data:function(){return{problemData:{},biz_code:"WT",tabNum:0,incident_id:"",is_upgrade_problem:"",bsid:"",title:"",userid:"",username:"",showOccurDatePickerFlag:!1,minOccurDate:new Date(2e3,0,1),maxOccurDate:new Date,pickingOccurDate:new Date,registeDate:"",showCreatUserTelKeyboard:!1,creatUserTel:"",urgency:{},showUrgencySelectorFlag:!1,urgencyLoading:!0,urgencySelector:[],urgencyList:[],origin:"",showOriginSelectorFlag:!1,originLoading:!0,originSelector:[],originList:[],team:{},showTeamSelectorFlag:!1,teamLoading:!0,teamSelector:[],teamList:[],showTargetSysSelectorFlag:!1,targetSysSelector:[],targetSys:{},targetSysLoading:!0,targetSysList:[],category:{},showCategorySelectorFlag:!1,categoryLoading:!0,categorySelector:[],categoryList:[],occurFrequency:{},showOccurFrequencySelectorFlag:!1,occurFrequencyLoading:!0,occurFrequencySelector:[],occurFrequencyList:[],againOccurRisk:"",editorData:"",source:{},sourceList:[],incidentLevel:"",showIncidentLevelSelectorFlag:!1,incidentLevelLoading:!0,incidentLevelSelector:[],incidentLevelList:[],sj_urgency:{},imgPreviewList:[],imgFileList:[]}},computed:{maxPlanFinishDate:function(){var e=new Date;return e.setMonth(e.getMonth()+6),e}},mounted:function(){this.confirmOccurDate(new Date),this.getBasicInfo()},methods:{backToIndex:function(){this.$router.slid="right",this.$router.back()},confirmOccurDate:function(e){var t=e.getMonth()+1;this.registeDate=e.getFullYear()+"-"+(t>9?t:"0"+t)+"-"+(e.getDate()>9?e.getDate():"0"+e.getDate())+" "+(e.getHours()>9?e.getHours():"0"+e.getHours())+":"+(e.getMinutes()>9?e.getMinutes():"0"+e.getMinutes())+":00",this.showOccurDatePickerFlag=!1},confirmUrgency:function(e,t){this.urgency=this.urgencyList[t],this.showUrgencySelectorFlag=!1},confirmCategory:function(e,t){this.category=this.categoryList[t],this.showCategorySelectorFlag=!1},confirmOccurFrequency:function(e,t){this.occurFrequency=this.occurFrequencyList[t],this.showOccurFrequencySelectorFlag=!1},confirmOrigin:function(e,t){this.origin=this.originList[t],this.showOriginSelectorFlag=!1},confirmTeam:function(e,t){var a=this;this.team=this.teamList[t],this.showTeamSelectorFlag=!1,this.$OmspRequest.sendRequest({url:"/appTaskRestService/getTargetSys",data:{team_id:this.team.id}}).then((function(e){a.targetSysList=e.data.targetSysList,a.targetSysSelector=[];for(var t=0;t<a.targetSysList.length;t++)a.targetSysSelector.push(a.targetSysList[t].name);1===a.targetSysList.length&&(a.targetSys=a.targetSysList[0]),a.targetSysLoading=!1,setTimeout((function(){if(a.targetSysList)for(var e=0;e<a.targetSysList.length;e++)a.problemData.target_sys===a.targetSysList[e].id&&(a.targetSys=a.targetSysList[e])}),0)})).catch((function(e){JSON.stringify(e),Object(k["a"])("加载失败，请重新登录")})).finally((function(){}))},confirmTargetSys:function(e,t){"number"===typeof t&&(this.targetSys=this.targetSysList[t]),this.showTargetSysSelectorFlag=!1},beforeReadImg:function(e){var t=e.type,a=["image/png","image/jpeg"];return!!a.includes(t)||(k["a"].fail("请上传:png、jpeg的图片格式"),!1)},afterReadImg:function(e){return e},save:function(e){var t=this,a=this.checkForm();a.flag?n["a"].confirm({title:"通知",message:"确定这项操作吗?"}).then((function(){k["a"].loading({mask:!0,forbidClick:!0,duration:0,message:"请稍后..."});var a=t.getFormData();setTimeout((function(){t.$OmspRequest.sendRequest({url:"/appProblemRestService/saveProblem",data:a}).then((function(a){k["a"].clear(),t.bsid=a.data.id,t.$nextTick((function(){t.$store.commit("page/removeCachePageName","OmspIndex"),"draft"===e?t.keepEdit():"commit"===e&&t.submit()}))})).catch((function(e){JSON.stringify(e),k["a"].fail("暂存失败")})).finally((function(){}))}),0)})).catch((function(){})):k["a"].fail(a.msg)},keepEdit:function(){var e=this;n["a"].confirm({title:"暂存成功",message:"是否继续修改？"}).then((function(){})).catch((function(){setTimeout((function(){e.$router.push({path:"index"})}))}))},submit:function(){var e=this;k["a"].loading({mask:!0,forbidClick:!0,duration:0,message:"提交中，请稍后..."});var t=this.getFormData();setTimeout((function(){e.$OmspRequest.sendRequest({url:"/appProblemRestService/submitProblem",data:{id:t.id}}).then((function(t){k["a"].clear(),JSON.stringify(t),n["a"].alert({message:"提交成功，即将返回主页"}).then((function(){e.$store.commit("page/removeCachePageName","OmspIndex"),setTimeout((function(){e.$router.push({path:"index"})}))}))})).catch((function(e){JSON.stringify(e),console.log(e),k["a"].fail("提交失败")})).finally((function(){}))}),0)},getFormData:function(){var e={bg_change_type:"",urgency_desc:this.urgency.name,sj_id:"",bg_orgname:"",is_view:"",sj_target_sys_desc:"",bg_applicant_phone:"",team_id:this.team.id,source:this.source.id,proc_inst_id_:"",registe_date:this.registeDate,incident_id:"",sj_category_desc:"",sj_applicant_phone:"",bg_target_sys_desc:"",category_desc:this.category.name,target_sys:this.targetSys.id,sj_orgname:"",bg_team_id_desc:"",id:this.bsid,again_occur_risk:this.againOccurRisk,bg_urgency:"",bg_urgency_desc:"",bg_team_id:"",sj_incident_level_desc:this.incidentLevel.name,orgid:this.origin.id,bg_category_desc:"",bg_change_plan:"",org_id:this.origin.id,sj_applicant:"",bg_category:"",bg_effect_scope:"",occur_frequency_desc:this.occurFrequency.name,bg_applicant:"",bg_id:"",description:this.editorData,sj_target_sys:"",title:this.title,sj_team_id:"",is_base:"1",urgency:this.urgency.id,is_draft:"1",source_desc:this.source.name,sj_incident_level:this.incidentLevel.id,bg_change_type_desc:"",bg_title:"",sj_title:"",sj_occur_date:"",bg_target_sys:"",sj_urgency:this.sj_urgency.id,sj_urgency_desc:this.sj_urgency.name,pos_orgname:this.origin.orgname,sj_category:"",team_id_desc:this.team.name,menuid:"",occur_frequency:this.occurFrequency.id,sj_team_id_desc:"",registe_phone:this.creatUserTel,category:this.category.id,target_sys_desc:this.targetSys.name,register:this.username};return e},getBasicInfo:function(){var e=this;Object(k["a"])({type:"loading",overlay:!0,message:"加载中...",duration:0,forbidClick:!0}),setTimeout((function(){e.$OmspRequest.sendRequest({url:"/appProblemRestService/getProblemBasicInfo",data:{}}).then((function(t){k["a"].clear(),e.username=t.data.username,e.userid=t.data.userid,e.urgencyList=t.data.urgencyList,e.urgencySelector=[];for(var a=0;a<e.urgencyList.length;a++)e.urgencySelector.push(e.urgencyList[a].name);e.urgencyLoading=!1,e.categoryList=t.data.categoryList,e.categorySelector=[];for(var i=0;i<e.categoryList.length;i++)e.categorySelector.push(e.categoryList[i].name);e.categoryLoading=!1,e.occurFrequencyList=t.data.occurFrequencyList,e.occurFrequencySelector=[];for(var r=0;r<e.occurFrequencyList.length;r++)e.occurFrequencySelector.push(e.occurFrequencyList[r].name);e.occurFrequencyLoading=!1,e.teamList=t.data.teamList,e.teamSelector=[];for(var c=0;c<e.teamList.length;c++)e.teamSelector.push(e.teamList[c].name);e.teamLoading=!1,1===e.teamList.length&&(e.team=e.teamList[0],e.confirmTeam("",0)),e.sourceList=t.data.problemSource,e.source=e.sourceList.find((function(e){return"02"===e.id})),e.incidentLevelList=t.data.incidentLevelList,e.incidentLevel=e.incidentLevelList.find((function(e){return"03"===e.id})),e.originList=t.data.originList,e.originSelector=[];for(var n=0;n<e.originList.length;n++)e.originSelector.push(e.originList[n].orgname);if(e.originLoading=!1,1===e.originList.length&&(e.origin=e.originList[0]),e.sj_urgency=e.urgencyList.find((function(e){return"03"===e.id})),e.$route.query.bsid&&"edit"===e.$route.query.editType?e.getInfoData(e.$route.query.bsid):"derivative"===e.$route.query.editType&&e.getIncidentFormData(e.$route.query.bsid),e.$route.query.incident_id){var o=e.$route.query;for(var s in o)"description"===s?e.editorData=o[s]:e[s]=o[s]}})).catch((function(e){JSON.stringify(e),Object(k["a"])("加载基础数据失败")})).finally((function(){}))}),0)},getIncidentFormData:function(e){var t=this;setTimeout((function(){t.$OmspRequest.sendRequest({url:"/appTaskRestService/getIncident",data:{id:e}}).then((function(e){})).catch((function(e){JSON.stringify(e),Object(k["a"])("加载表单数据失败")})).finally((function(){}))}),0)},checkForm:function(){var e={flag:!1,msg:""};return""===this.title?e.msg="请输入标题":""===this.registeDate?e.msg="请输入提出时间":""===this.username?e.msg="没有提出人":""===this.creatUserTel?e.msg="请输入提出人电话":""===this.urgency?e.msg="请选择紧急度":""===this.category?e.msg="请选择问题分类":""===this.team?e.msg="请选择所属团队":""===this.targetSys?e.msg="请选择所属系统":""===this.editorData?e.msg="请输入问题描述":e.flag=!0,e},getInfoData:function(e){var t=this;setTimeout((function(){t.$OmspRequest.sendRequest({url:"/appProblemRestService/getProblem",data:{id:e}}).then((function(e){t.problemData=JSON.parse(e.data.result),t.bsid=t.problemData.id,t.incident_id=t.problemData.incident_id,t.is_upgrade_problem=t.problemData.is_upgrade_problem,t.title=t.problemData.title,t.pickingOccurDate=t.problemData.registe_date,t.registeDate=t.problemData.registe_date,t.creatUserTel=t.problemData.registe_phone;for(var a=0;a<t.categoryList.length;a++)t.problemData.category===t.categoryList[a].id&&(t.category=t.categoryList[a]);for(var i=0;i<t.urgencyList.length;i++)t.problemData.urgency===t.urgencyList[i].id&&(t.urgency=t.urgencyList[i]);for(var r=0;r<t.occurFrequencyList.length;r++)t.problemData.occur_frequency===t.occurFrequencyList[r].id&&(t.occurFrequency=t.occurFrequencyList[r]);for(var c=0;c<t.teamList.length;c++)t.problemData.team_id===t.teamList[c].id&&t.confirmTeam("",c);t.againOccurRisk=t.problemData.again_occur_risk,t.editorData=t.problemData.description})).catch((function(e){JSON.stringify(e),Object(k["a"])("加载失败，请重新登录")})).finally((function(){}))}),0)}}},D=w,q=(a("4c4b"),a("2877")),T=Object(q["a"])(D,r,c,!1,null,"b58ee198",null);t["default"]=T.exports},8468:function(e,t,a){},a156:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ckeditor",e._b({attrs:{editor:e.editor,config:e.editorConfig},model:{value:e.editorData,callback:function(t){e.editorData=t},expression:"editorData"}},"ckeditor",e.$attrs,!1))},r=[],c={name:"OmspEditor",components:{},props:{value:{type:String,default:""}},data:function(){return{editor:this.$OmspClassicEditor,editorData:"",editorConfig:{placeholder:"请输入······",toolbar:[]}}},watch:{value:function(e){this.editorData=e},editorData:function(e){this.$emit("input",e)}},mounted:function(){this.editorData=this.value}},n=c,o=a("2877"),s=Object(o["a"])(n,i,r,!1,null,"83061b96",null);t["a"]=s.exports}}]);